---
title: "Embedded Lecture-1: Build Process"
date: 2025-09-21 00:00:00  +0500
categories: [Embedded]
tags: [Microcontroller]
---

### What is cross compilation?
Cross-compilation is a process in which the cross-toolchain runs on the host machine (PC) and creates
executables that run on different machine (ARM).

### Cross Compilation ToolChains
-   Collection of binaries which allows to compile, assemble, link your applications.
-   It also contains binaries to debug the application on the target.
-   Tool chain also comes with other binaries which help you to analyze the executables
    -   dissect the different sections of the executables
    -   disassemble
    -   extract symbol and size information
    -   convert executable to other formats such as bin, ihex
    -   provides 'C' standard libaries

### Popular toolchain:
-   GNU Tools (GCC) for ARM embedded processors (free and open-source)
-   armcc from ARM Ltd. (ships with KEIL, code restriction version, requires licensing)

### Important Binaries
-   Complier, Linker & Assembler (arm-none-eabi-gcc)
-   Linker (arm-none-eabi-ld)
-   ELF file analyzer (arm-none-eabi-objdump, arm-none-eabi-readelf, arm-none-eabi-nm)
-   Fromat converter (arm-none-eabi-objcopy)

### Build Process

-   main.c -> compiler -> main.i (Pre-processing stage) 
-   main.i -> compiler -> main.s (code generation stage: higher level lanaguage to processor arch level mnemonics)
-   main.s -> compliler -> main.o (relocatble object file) (assember stage: assembly level mnemonics to opcodes (machine code instructions)) with no absolute address (relocatable)

### Linking Stage
-  relocatble object files -> (reslove all symbols and merging all the sections) .elf (executable and linkable format)

### Summary of build process
-   arm-none-eabi-gcc
    -   pre-processing
    -   compilation
    -   linking

### Makefile

```
CC=arm-none-eabi-none
MACH=cortex-m4
CFLAGS= -c -mcpu=$(MACH) -mthumb -std=gnu11 -O0

main.o:main.c
    $(CC) $(CFLAGS) $^ -o $@

```
  
### Analyzing .o files (relocatable object files)
-   main.o is in elf format(executable and linkable format)
-   ELF is a standard file format for object files and executable files when you use GCC
-   A file format standard describes a way of organizing various elements (data, read-only data, code,
    uninitialized data, etc.) of a program in different sections.

### main.c

```
/**
  ******************************************************************************
  * @file    main.c
  * @author  Auto-generated by STM32CubeIDE
  * @version V1.0
  * @brief   Default main function.
  ******************************************************************************
*/



#include <stdio.h>
int g_var1 = 400;
int g_var2 = 200;
int g_result = 0;

int main(void)
{
        g_result = g_var1 + g_var2;
        printf("Result: %d\n",g_result);
        for(;;);
}
```

### arm-none-eabi-objdump -h main.o

```
main.o:     file format elf32-littlearm

Sections:
Idx Name          Size      VMA       LMA       File off  Algn
  0 .text         00000030  00000000  00000000  00000034  2**2
                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE
  1 .data         00000008  00000000  00000000  00000064  2**2
                  CONTENTS, ALLOC, LOAD, DATA
  2 .bss          00000004  00000000  00000000  0000006c  2**2
                  ALLOC
  3 .rodata       0000000c  00000000  00000000  0000006c  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  4 .comment      00000034  00000000  00000000  00000078  2**0
                  CONTENTS, READONLY
  5 .ARM.attributes 0000002e  00000000  00000000  000000ac  2**0
                  CONTENTS, READONLY
```


### arm-none-eabi-objdump -D main.o
```
techsavy@Sahil-Saini-Mr-Project:~/ToolChain_Demo$ cat log

main.o:     file format elf32-littlearm


Disassembly of section .text:

00000000 <main>:
   0:   b580            push    {r7, lr}
   2:   af00            add     r7, sp, #0
   4:   4b06            ldr     r3, [pc, #24]   ; (20 <main+0x20>)
   6:   681a            ldr     r2, [r3, #0]
   8:   4b06            ldr     r3, [pc, #24]   ; (24 <main+0x24>)
   a:   681b            ldr     r3, [r3, #0]
   c:   4413            add     r3, r2
   e:   4a06            ldr     r2, [pc, #24]   ; (28 <main+0x28>)
  10:   6013            str     r3, [r2, #0]
  12:   4b05            ldr     r3, [pc, #20]   ; (28 <main+0x28>)
  14:   681b            ldr     r3, [r3, #0]
  16:   4619            mov     r1, r3
  18:   4804            ldr     r0, [pc, #16]   ; (2c <main+0x2c>)
  1a:   f7ff fffe       bl      0 <printf>
  1e:   e7fe            b.n     1e <main+0x1e>
        ...

Disassembly of section .data:

00000000 <g_var1>:
   0:   00000190        muleq   r0, r0, r1

00000004 <g_var2>:
   4:   000000c8        andeq   r0, r0, r8, asr #1

Disassembly of section .bss:

00000000 <g_result>:
   0:   00000000        andeq   r0, r0, r0

Disassembly of section .rodata:

00000000 <.rodata>:
   0:   75736552        ldrbvc  r6, [r3, #-1362]!       ; 0xfffffaae
   4:   203a746c        eorscs  r7, sl, ip, ror #8
   8:   000a6425        andeq   r6, sl, r5, lsr #8

Disassembly of section .comment:

00000000 <.comment>:
   0:   43434700        movtmi  r4, #14080      ; 0x3700
   4:   3128203a                        ; <UNDEFINED> instruction: 0x3128203a
   8:   30313a35        eorscc  r3, r1, r5, lsr sl
   c:   322d332e        eorcc   r3, sp, #-1207959552    ; 0xb8000000
  10:   2e313230        mrccs   2, 1, r3, cr1, cr0, {1}
  14:   342d3730        strtcc  r3, [sp], #-1840        ; 0xfffff8d0
  18:   30312029        eorscc  r2, r1, r9, lsr #32
  1c:   312e332e                        ; <UNDEFINED> instruction: 0x312e332e
  20:   32303220        eorscc  r3, r0, #32, 4
  24:   32363031        eorscc  r3, r6, #49     ; 0x31
  28:   72282031        eorvc   r2, r8, #49     ; 0x31
  2c:   61656c65        cmnvs   r5, r5, ror #24
  30:   00296573        eoreq   r6, r9, r3, ror r5

Disassembly of section .ARM.attributes:

00000000 <.ARM.attributes>:
   0:   00002d41        andeq   r2, r0, r1, asr #26
   4:   61656100        cmnvs   r5, r0, lsl #2
   8:   01006962        tsteq   r0, r2, ror #18
   c:   00000023        andeq   r0, r0, r3, lsr #32
  10:   2d453705        stclcs  7, cr3, [r5, #-20]      ; 0xffffffec
  14:   0d06004d        stceq   0, cr0, [r6, #-308]     ; 0xfffffecc
  18:   02094d07        andeq   r4, r9, #448    ; 0x1c0
  1c:   01140412        tsteq   r4, r2, lsl r4
  20:   03170115        tsteq   r7, #1073741829 ; 0x40000005
  24:   01190118        tsteq   r9, r8, lsl r1
  28:   061e011a                        ; <UNDEFINED> instruction: 0x061e011a
  2c:   Address 0x000000000000002c is out of bounds.
```
